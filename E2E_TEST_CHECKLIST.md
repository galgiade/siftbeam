# 🚀 簡易E2Eテストチェックリスト（5-10分）

> **目的**: 最小限の時間で主要機能の動作を確認し、重大なバグを検出する

## 📖 テストの基本方針

### ✅ このチェックリストでテストすること
- **正常系（ハッピーパス）のみ**: 正しい入力で機能が動作するか
- **統合確認**: 画面遷移、データ連携、API通信が正常に動作するか
- **重大なバグ検出**: アプリが完全に動かなくなるような致命的な問題

### ❌ このチェックリストでテストしないこと
- **入力バリデーション**: 数字のみ、空欄、形式エラーなど → **ユニットテストでカバー済み**
- **エッジケース**: 境界値、特殊文字、極端なデータ → **自動テストでカバー**
- **エラーハンドリングの全パターン**: 各種エラーメッセージの表示確認 → **必要に応じて自動化**

### 🎯 時短の鍵
**「正常に動けばOK」の精神で、異常系は最小限に！**

---

## ✅ テスト実施前の準備（30秒）

- [ ] 開発サーバーが起動している (`npm run dev`)
- [ ] テスト用アカウント情報を準備
  - メールアドレス: ________________
  - パスワード: ________________
- [ ] ブラウザのキャッシュをクリア（推奨）

---

## 🔥 最優先テスト（必須 - 3分）

### 1. サインイン機能 ⏱️ 1分
- [ ] `/ja/signin` にアクセス
- [ ] **正常系のみテスト**: 有効なメールアドレスとパスワードを入力
- [ ] 「サインイン」ボタンをクリック
- [ ] **期待結果**: ダッシュボード（`/ja/account/user`）にリダイレクト

**⚠️ スキップする項目（バリデーションは自動テストでカバー）**:
- ❌ パスワードの形式エラー（数字のみ、アルファベットのみ、8文字未満など）
- ❌ メールアドレスの形式エラー（@なし、ドメインなしなど）
- ❌ 空欄エラー
- ❌ 存在しないユーザーエラー
- ❌ 間違ったパスワードエラー

**理由**: これらは**ユニットテスト**で既にカバーされています（`AuthErrorHandler.test.tsx`, `PhoneInput.test.tsx`）

**❌ 失敗時の影響**: ユーザーがログインできない（致命的）

---

### 2. サービスページ - ファイルアップロード ⏱️ 2分
- [ ] `/ja/service` にアクセス（認証済み）
- [ ] ポリシーが表示されることを確認
- [ ] ポリシーを1つ選択
- [ ] ファイルアップロードエリアが有効になることを確認
- [ ] **正常系のみテスト**: 小さな有効なファイル（例: 100KB以下のPDF）をアップロード
- [ ] **期待結果**: 
  - アップロード進捗が表示される
  - 処理履歴に新しいエントリが追加される
  - ステータスが「処理中」または「成功」になる

**⚠️ スキップする項目（バリデーションは自動テストでカバー）**:
- ❌ ファイルサイズ超過エラー（例: 10GB以上）
- ❌ 無効なファイル形式エラー（例: .exe, .zipなど）
- ❌ ポリシー未選択エラー
- ❌ 利用制限超過エラー
- ❌ 複数ファイル同時アップロード

**理由**: これらのバリデーションは**クライアント側とサーバー側**で既に実装済み

**❌ 失敗時の影響**: コア機能が動作しない（致命的）

---

## ⚠️ 重要テスト（推奨 - 3分）

### 3. ユーザー情報表示 ⏱️ 30秒
- [ ] `/ja/account/user` にアクセス
- [ ] ユーザー名、メールアドレスが正しく表示される
- [ ] **期待結果**: ユーザー情報が表示される

**❌ 失敗時の影響**: ユーザーが自分の情報を確認できない

---

### 4. APIキー管理 ⏱️ 1分
- [ ] `/ja/account/api-keys` にアクセス
- [ ] 既存のAPIキーリストが表示される（または「APIキーがありません」）
- [ ] 「新規作成」ボタンが表示される
- [ ] **期待結果**: ページがエラーなく表示される

**❌ 失敗時の影響**: API連携ができない

---

### 5. 支払い情報 ⏱️ 30秒
- [ ] `/ja/account/payment` にアクセス
- [ ] 支払い方法が表示される（または「未設定」）
- [ ] **期待結果**: ページがエラーなく表示される

**❌ 失敗時の影響**: 課金ができない（ビジネスに影響）

---

### 6. サインアウト ⏱️ 30秒
- [ ] サイドナビゲーションから「サインアウト」をクリック
- [ ] **期待結果**: サインインページ（`/ja/signin`）にリダイレクト
- [ ] 認証が必要なページにアクセスできないことを確認

**❌ 失敗時の影響**: セキュリティリスク

---

## 📝 補足テスト（時間があれば - 4分）

### 7. 言語切り替え ⏱️ 30秒
- [ ] ヘッダーの言語切り替えボタンをクリック
- [ ] 英語（`/en/...`）に切り替わることを確認
- [ ] 日本語（`/ja/...`）に戻せることを確認

---

### 8. レスポンシブデザイン ⏱️ 1分
- [ ] ブラウザウィンドウを縮小（モバイルサイズ）
- [ ] サイドナビゲーションがハンバーガーメニューになる
- [ ] 主要ページ（サービス、ユーザー）が崩れていない

---

### 9. 処理履歴の表示 ⏱️ 1分
- [ ] `/ja/service` の処理履歴セクションを確認
- [ ] 過去のアップロード履歴が表示される
- [ ] ステータス（成功/失敗/処理中）が表示される
- [ ] ダウンロードボタンが表示される（成功時）

---

### 10. 認証保護の確認 ⏱️ 30秒
- [ ] サインアウト状態で `/ja/account/user` にアクセス
- [ ] **期待結果**: サインインページにリダイレクト

**⚠️ スキップする項目**:
- ❌ 404エラーページの表示確認
- ❌ 各種エラーメッセージの文言確認
- ❌ ネットワークエラーのハンドリング

---

## 🎯 テスト結果サマリー

| カテゴリ | 項目数 | 合格 | 不合格 | 備考 |
|---------|--------|------|--------|------|
| 最優先（必須） | 2 |  |  |  |
| 重要（推奨） | 4 |  |  |  |
| 補足 | 4 |  |  |  |
| **合計** | **10** |  |  |  |

---

## 🚨 テスト失敗時の対応

### 優先度1: 最優先テストが失敗
→ **即座に修正が必要**。デプロイを延期してください。

### 優先度2: 重要テストが失敗
→ **修正を推奨**。ただし、影響範囲が限定的なら条件付きでデプロイ可能。

### 優先度3: 補足テストが失敗
→ **後で修正可能**。デプロイは問題なし。

---

## 📌 テスト効率化のヒント

1. **ブラウザの開発者ツール（F12）を開いておく**
   - コンソールエラーを即座に確認できる
   - ネットワークエラーを検出できる

2. **テスト用アカウントを事前に準備**
   - サインアップの時間を節約
   - 一貫したテスト環境

3. **小さなテストファイルを用意**
   - 100KB以下のPDF/画像
   - アップロード時間を短縮

4. **ブラウザのブックマークを活用**
   - 主要ページをブックマーク
   - ページ遷移の時間を短縮

---

## 🔧 バリデーションテストは自動化で対応

### 現在の状況
プロジェクトには既に**22個のユニットテスト**が存在します：
- `AuthErrorHandler.test.tsx` - 認証エラーのバリデーション
- `PhoneInput.test.tsx` - 電話番号の入力バリデーション
- `password-validation.test.ts` - パスワード形式のバリデーション
- その他19個のテストファイル

### 推奨: E2Eテスト自動化の導入

手動で入力バリデーションをテストする代わりに、Playwrightで自動化：

```typescript
// 例: サインインの正常系テスト（30秒で完了）
test('ユーザーがサインインできる', async ({ page }) => {
  await page.goto('/ja/signin');
  await page.fill('[name="email"]', 'test@example.com');
  await page.fill('[name="password"]', 'ValidPass123');
  await page.click('button[type="submit"]');
  await expect(page).toHaveURL(/\/ja\/account\/user/);
});

// 例: バリデーションエラーのテスト（自動化で網羅）
test.describe('サインインのバリデーション', () => {
  test('数字のみのパスワードはエラー', async ({ page }) => {
    await page.goto('/ja/signin');
    await page.fill('[name="email"]', 'test@example.com');
    await page.fill('[name="password"]', '12345678');
    await expect(page.locator('.error-message')).toContainText('パスワードの形式が無効');
  });

  test('8文字未満のパスワードはエラー', async ({ page }) => {
    // ... 自動化で全パターンをカバー
  });
});
```

**自動化のメリット**:
- 手動5-10分 → 自動30秒に短縮
- 全パターン（20+）を網羅可能
- CI/CDで毎回実行
- 人的ミスゼロ

**導入コスト**: 初回セットアップ 2-3時間 → 以降は永続的に時間節約

---

## 📞 問題が発生した場合

1. **コンソールエラーをスクリーンショット**
2. **再現手順をメモ**
3. **ブラウザとOSのバージョンを記録**
4. **開発チームに報告**

---

**最終更新**: 2025年11月8日  
**対象環境**: Next.js 16 + TypeScript + HeroUI

