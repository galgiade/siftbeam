# ãƒ‡ãƒ¼ã‚¿å‡¦ç†æ©Ÿæ§‹ã®ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆï¼ˆæ”¹è¨‚ç‰ˆï¼‰

## å‰ææ¡ä»¶ã®ç¢ºèª

### ãƒãƒªã‚·ãƒ¼ã”ã¨ã®å‡¦ç†ã®é•ã„

å„ãƒãƒªã‚·ãƒ¼ã¯**å…¨ãç•°ãªã‚‹è¤‡é›‘ãªå‡¦ç†**ã‚’å®Ÿè¡Œã—ã¾ã™:

- **ç”»åƒãƒ‡ãƒ¼ã‚¿å‡¦ç†**: ãƒªã‚µã‚¤ã‚ºã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ã€åœ§ç¸®ã€é€ã‹ã—è¿½åŠ ã€é¡”èªè­˜ãªã©
- **è¡¨è¨ˆç®—ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã€é›†è¨ˆã€ã‚°ãƒ©ãƒ•ç”Ÿæˆã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ãªã©
- **å‹•ç”»ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: ãƒˆãƒ©ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã€å­—å¹•è¿½åŠ ãªã©
- **éŸ³å£°ãƒ‡ãƒ¼ã‚¿å‡¦ç†**: æ–‡å­—èµ·ã“ã—ã€ãƒã‚¤ã‚ºé™¤å»ã€ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›ãªã©
- **ãƒ†ã‚­ã‚¹ãƒˆãƒ‡ãƒ¼ã‚¿å‡¦ç†**: è‡ªç„¶è¨€èªå‡¦ç†ã€ç¿»è¨³ã€è¦ç´„ã€æ„Ÿæƒ…åˆ†æãªã©
- **PDFãƒ‡ãƒ¼ã‚¿å‡¦ç†**: ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã€ç”»åƒæŠ½å‡ºã€çµåˆã€åˆ†å‰²ãªã©

ã“ã‚Œã‚‰ã®å‡¦ç†ã¯ã€ãã‚Œãã‚Œ**ç‹¬è‡ªã®è¤‡é›‘ãªãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼**ã‚’æŒã¡ã¾ã™ã€‚

### è¦ªå­Step Functionæ§‹é€ ã®å¿…è¦æ€§

#### è¦ªStep Functionï¼ˆæ±ç”¨å‡¦ç†ï¼‰
```
- å…¥åŠ›æ¤œè¨¼
- ä½¿ç”¨é‡ãƒã‚§ãƒƒã‚¯
- ãƒãƒªã‚·ãƒ¼ã«å¿œã˜ãŸå­Step Functioné¸æŠ
- èª²é‡‘ãƒ¡ãƒ¼ã‚¿ãƒ¼å‡¦ç†
- å®Œäº†/å¤±æ•—ã®çŠ¶æ…‹ç®¡ç†
- é€šçŸ¥å‡¦ç†
```

#### å­Step Functionï¼ˆãƒãƒªã‚·ãƒ¼å›ºæœ‰ã®å‡¦ç†ï¼‰
```
- ç”»åƒå‡¦ç†ç”¨: è¤‡æ•°ã‚¹ãƒ†ãƒƒãƒ—ã®ç”»åƒå¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- è¡¨è¨ˆç®—å‡¦ç†ç”¨: ãƒ‡ãƒ¼ã‚¿è§£æãƒ»å¤‰æ›ãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- å‹•ç”»å‡¦ç†ç”¨: MediaConverté€£æºãƒ‘ã‚¤ãƒ—ãƒ©ã‚¤ãƒ³
- ãªã©ã€ãƒãƒªã‚·ãƒ¼ã”ã¨ã«å®Œå…¨ã«ç•°ãªã‚‹ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼
```

**çµè«–**: è¦ªå­æ§‹é€ ã¯**å¿…è¦ã‹ã¤é©åˆ‡**ã§ã™ã€‚

---

## æ¨å¥¨ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ï¼ˆæ”¹è¨‚ç‰ˆï¼‰

### å…¨ä½“ãƒ¯ãƒ¼ã‚¯ãƒ•ãƒ­ãƒ¼

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 1. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (ServiceFileUploader.tsx)                         â”‚
â”‚    - ãƒ•ã‚¡ã‚¤ãƒ«é¸æŠ                                                  â”‚
â”‚    - åˆ©ç”¨åˆ¶é™ãƒã‚§ãƒƒã‚¯                                              â”‚
â”‚    - processing-historyä½œæˆ (status: in_progress)                 â”‚
â”‚    - S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ (ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ä»˜ã)                             â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 2. S3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥                                                  â”‚
â”‚    - ãƒã‚±ãƒƒãƒˆ: siftbeam                                            â”‚
â”‚    - ãƒ—ãƒ¬ãƒ•ã‚£ãƒƒã‚¯ã‚¹: service/input/                                â”‚
â”‚    - ã‚¤ãƒ™ãƒ³ãƒˆ: s3:ObjectCreated:*                                 â”‚
â”‚    - ã‚¿ãƒ¼ã‚²ãƒƒãƒˆ: Lambda (TriggerParentStepFunction)                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 3. Lambda: TriggerParentStepFunction                              â”‚
â”‚    - S3ãƒ‘ã‚¹ã‹ã‚‰processingHistoryIdã‚’æŠ½å‡º                          â”‚
â”‚    - S3ãƒ¡ã‚¿ãƒ‡ãƒ¼ã‚¿ç¢ºèª (triggerStepFunction == 'true')             â”‚
â”‚    - DynamoDBã‹ã‚‰processing-historyå–å¾—                           â”‚
â”‚    - è¦ªStep Functionã‚’èµ·å‹•                                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                            â†“
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â•‘ 4. è¦ªStep Function: ParentProcessingWorkflow                     â•‘
â•‘                                                                  â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 1: ValidateInput                        â”‚            â•‘
â•‘    â”‚  - ãƒ•ã‚¡ã‚¤ãƒ«å­˜åœ¨ç¢ºèª                            â”‚            â•‘
â•‘    â”‚  - ãƒ•ã‚¡ã‚¤ãƒ«ã‚µã‚¤ã‚ºç¢ºèª                          â”‚            â•‘
â•‘    â”‚  - ãƒãƒªã‚·ãƒ¼æƒ…å ±å–å¾—                            â”‚            â•‘
â•‘    â”‚  - ä½¿ç”¨é‡åˆ¶é™ãƒã‚§ãƒƒã‚¯ï¼ˆäº‹å‰ç¢ºèªï¼‰              â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 2: DetermineChildStateMachine           â”‚            â•‘
â•‘    â”‚  - policyIdã«åŸºã¥ã„ã¦å­Step Functionã®ARNã‚’æ±ºå®š â”‚            â•‘
â•‘    â”‚                                               â”‚            â•‘
â•‘    â”‚  Choice State:                                â”‚            â•‘
â•‘    â”‚    policy-image       â†’ ImageProcessingSM     â”‚            â•‘
â•‘    â”‚    policy-spreadsheet â†’ SpreadsheetSM         â”‚            â•‘
â•‘    â”‚    policy-video       â†’ VideoProcessingSM     â”‚            â•‘
â•‘    â”‚    policy-audio       â†’ AudioProcessingSM     â”‚            â•‘
â•‘    â”‚    policy-text        â†’ TextProcessingSM      â”‚            â•‘
â•‘    â”‚    policy-pdf         â†’ PDFProcessingSM       â”‚            â•‘
â•‘    â”‚    unknown            â†’ Fail                  â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 3: InvokeChildStateMachine              â”‚            â•‘
â•‘    â”‚  - Task Type: Step Functions (StartExecution) â”‚            â•‘
â•‘    â”‚  - å­Step Functionã‚’èµ·å‹•                       â”‚            â•‘
â•‘    â”‚  - åŒæœŸå®Ÿè¡Œ (waitForTaskToken ã¾ãŸã¯ .sync)    â”‚            â•‘
â•‘    â”‚  - å­ã®å®Œäº†ã‚’å¾…æ©Ÿ                              â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 4: ProcessChildResult                   â”‚            â•‘
â•‘    â”‚  - å­Step Functionã®çµæœã‚’å–å¾—                 â”‚            â•‘
â•‘    â”‚  - outputS3Keys, totalSizeBytesã‚’æŠ½å‡º          â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 5: UpdateProcessingHistory              â”‚            â•‘
â•‘    â”‚  - status: success                            â”‚            â•‘
â•‘    â”‚  - downloadS3Keys: (å­ã‹ã‚‰ã®çµæœ)              â”‚            â•‘
â•‘    â”‚  - usageAmountBytes: (å­ã‹ã‚‰ã®çµæœ)            â”‚            â•‘
â•‘    â”‚  - completedAt: ISO8601                       â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 6: CalculateMonthlyUsage                â”‚            â•‘
â•‘    â”‚  - ä»Šæœˆã®åˆè¨ˆä½¿ç”¨é‡ã‚’è¨ˆç®—                      â”‚            â•‘
â•‘    â”‚  - DynamoDBã®processing-historyã‹ã‚‰é›†è¨ˆ        â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 7: CheckUsageLimit                      â”‚            â•‘
â•‘    â”‚  - usage-limitsãƒ†ãƒ¼ãƒ–ãƒ«ã‹ã‚‰åˆ¶é™å€¤å–å¾—           â”‚            â•‘
â•‘    â”‚  - é€šçŸ¥åˆ¶é™ã‚’è¶…ãˆã¦ã„ã‚‹ã‹ç¢ºèª                  â”‚            â•‘
â•‘    â”‚  - é€šçŸ¥ãŒå¿…è¦ã‹ã©ã†ã‹åˆ¤å®š                      â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 8: ShouldSendNotification (Choice)      â”‚            â•‘
â•‘    â”‚  - shouldNotify == true â†’ SendNotification    â”‚            â•‘
â•‘    â”‚  - shouldNotify == false â†’ Success            â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 9: SendNotification (Conditional)       â”‚            â•‘
â•‘    â”‚  - SESã§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡                         â”‚            â•‘
â•‘    â”‚  - é€šçŸ¥åˆ¶é™ã‚’è¶…ãˆãŸã“ã¨ã‚’é€šçŸ¥                  â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 10: Success                             â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                  â•‘
â•‘    [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°]                                           â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ Catch: HandleError                            â”‚            â•‘
â•‘    â”‚  - ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¨˜éŒ²                            â”‚            â•‘
â•‘    â”‚  - processing-historyæ›´æ–° (status: failed)     â”‚            â•‘
â•‘    â”‚  - errorDetailè¨˜éŒ²                            â”‚            â•‘
â•‘    â”‚  - completedAtè¨­å®š                            â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State: Fail                                   â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â†“ (å­Step Functionèµ·å‹•)
â”Œâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â”
â•‘ 5. å­Step Function: ä¾‹) ImageProcessingStateMachine             â•‘
â•‘                                                                  â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 1: DownloadFromS3                       â”‚            â•‘
â•‘    â”‚  - å…¥åŠ›ãƒ•ã‚¡ã‚¤ãƒ«ã‚’S3ã‹ã‚‰ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰            â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 2: ValidateImageFormat                  â”‚            â•‘
â•‘    â”‚  - ç”»åƒãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¤œè¨¼                        â”‚            â•‘
â•‘    â”‚  - ã‚µãƒãƒ¼ãƒˆå½¢å¼: JPEG, PNG, GIF, WebP          â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 3: ResizeImage                          â”‚            â•‘
â•‘    â”‚  - Lambda: ç”»åƒãƒªã‚µã‚¤ã‚ºå‡¦ç†                    â”‚            â•‘
â•‘    â”‚  - è¤‡æ•°ã‚µã‚¤ã‚ºç”Ÿæˆï¼ˆã‚µãƒ ãƒã‚¤ãƒ«ã€ä¸­ã€å¤§ï¼‰        â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 4: OptimizeImage                        â”‚            â•‘
â•‘    â”‚  - Lambda: ç”»åƒæœ€é©åŒ–ï¼ˆåœ§ç¸®ï¼‰                  â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 5: AddWatermark (Conditional)           â”‚            â•‘
â•‘    â”‚  - Lambda: é€ã‹ã—è¿½åŠ                           â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 6: ConvertFormat                        â”‚            â•‘
â•‘    â”‚  - Lambda: ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆå¤‰æ›                    â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 7: UploadToS3                           â”‚            â•‘
â•‘    â”‚  - å‡¦ç†æ¸ˆã¿ç”»åƒã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰              â”‚            â•‘
â•‘    â”‚  - ãƒ‘ã‚¹: service/output/{customerId}/         â”‚            â•‘
â•‘    â”‚         {processingHistoryId}/                â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                     â†“                                            â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ State 8: ReturnResult                         â”‚            â•‘
â•‘    â”‚  - çµæœã‚’è¿”ã™:                                 â”‚            â•‘
â•‘    â”‚    {                                          â”‚            â•‘
â•‘    â”‚      "outputS3Keys": [...],                   â”‚            â•‘
â•‘    â”‚      "totalSizeBytes": 1234567,               â”‚            â•‘
â•‘    â”‚      "processedCount": 3                      â”‚            â•‘
â•‘    â”‚    }                                          â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                  â•‘
â•‘    [ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°]                                           â•‘
â•‘    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”            â•‘
â•‘    â”‚ Catch: ChildHandleError                       â”‚            â•‘
â•‘    â”‚  - ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¿”ã™                            â”‚            â•‘
â•‘    â”‚  - è¦ªStep Functionã«ä¼æ’­                       â”‚            â•‘
â•‘    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜            â•‘
â•‘                                                                  â•‘
â•šâ•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•
                            â†“ (çµæœã‚’è¦ªã«è¿”ã™)
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ 6. ã‚¯ãƒ©ã‚¤ã‚¢ãƒ³ãƒˆ (ProcessingHistoryList.tsx)                       â”‚
â”‚    - å®šæœŸçš„ã«processing-historyã‚’ãƒãƒ¼ãƒªãƒ³ã‚°                        â”‚
â”‚    - status: success â†’ ãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ãƒœã‚¿ãƒ³è¡¨ç¤º                      â”‚
â”‚    - status: failed â†’ ã‚¨ãƒ©ãƒ¼è©³ç´°è¡¨ç¤º                               â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## è¦ªStep Functionã®è©³ç´°è¨­è¨ˆ

### è¦ªStep Function: ParentProcessingWorkflow

**ASL (Amazon States Language) å®šç¾©**

```json
{
  "Comment": "SiftBeam Parent Processing Workflow - æ±ç”¨å‡¦ç†",
  "StartAt": "ValidateInput",
  "States": {
    "ValidateInput": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ValidateInput",
      "Parameters": {
        "processingHistoryId.$": "$.processingHistoryId",
        "customerId.$": "$.customerId",
        "inputS3Key.$": "$.inputS3Key",
        "inputS3Bucket.$": "$.inputS3Bucket",
        "policyId.$": "$.policyId",
        "userId.$": "$.userId"
      },
      "ResultPath": "$.validationResult",
      "Next": "DetermineChildStateMachine",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "HandleError"
        }
      ]
    },
    "DetermineChildStateMachine": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-image-processing",
          "Next": "SetImageProcessingSM"
        },
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-spreadsheet-processing",
          "Next": "SetSpreadsheetProcessingSM"
        },
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-video-processing",
          "Next": "SetVideoProcessingSM"
        },
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-audio-processing",
          "Next": "SetAudioProcessingSM"
        },
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-text-processing",
          "Next": "SetTextProcessingSM"
        },
        {
          "Variable": "$.policyId",
          "StringEquals": "policy-pdf-processing",
          "Next": "SetPDFProcessingSM"
        }
      ],
      "Default": "UnsupportedPolicy"
    },
    "SetImageProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:ImageProcessingSM",
        "policyType": "image"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "SetSpreadsheetProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:SpreadsheetProcessingSM",
        "policyType": "spreadsheet"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "SetVideoProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:VideoProcessingSM",
        "policyType": "video"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "SetAudioProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:AudioProcessingSM",
        "policyType": "audio"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "SetTextProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:TextProcessingSM",
        "policyType": "text"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "SetPDFProcessingSM": {
      "Type": "Pass",
      "Parameters": {
        "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:PDFProcessingSM",
        "policyType": "pdf"
      },
      "ResultPath": "$.childSMInfo",
      "Next": "InvokeChildStateMachine"
    },
    "InvokeChildStateMachine": {
      "Type": "Task",
      "Resource": "arn:aws:states:::states:startExecution.sync:2",
      "Parameters": {
        "StateMachineArn.$": "$.childSMInfo.childStateMachineArn",
        "Input": {
          "processingHistoryId.$": "$.processingHistoryId",
          "customerId.$": "$.customerId",
          "userId.$": "$.userId",
          "userName.$": "$.userName",
          "policyId.$": "$.policyId",
          "policyName.$": "$.policyName",
          "inputS3Key.$": "$.inputS3Key",
          "inputS3Bucket.$": "$.inputS3Bucket",
          "uploadedFileKeys.$": "$.uploadedFileKeys",
          "aiTrainingUsage.$": "$.aiTrainingUsage",
          "createdAt.$": "$.createdAt",
          "AWS_STEP_FUNCTIONS_STARTED_BY_EXECUTION_ID.$": "$$.Execution.Id"
        }
      },
      "ResultPath": "$.childResult",
      "Next": "ProcessChildResult",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "HandleChildError"
        }
      ]
    },
    "ProcessChildResult": {
      "Type": "Pass",
      "Parameters": {
        "outputS3Keys.$": "$.childResult.Output.outputS3Keys",
        "totalSizeBytes.$": "$.childResult.Output.totalSizeBytes",
        "processedCount.$": "$.childResult.Output.processedCount"
      },
      "ResultPath": "$.processingResult",
      "Next": "UpdateProcessingHistorySuccess"
    },
    "UpdateProcessingHistorySuccess": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:UpdateProcessingHistory",
      "Parameters": {
        "processingHistoryId.$": "$.processingHistoryId",
        "status": "success",
        "downloadS3Keys.$": "$.processingResult.outputS3Keys",
        "usageAmountBytes.$": "$.processingResult.totalSizeBytes",
        "completedAt.$": "$$.State.EnteredTime"
      },
      "ResultPath": "$.updateResult",
      "Next": "CalculateMonthlyUsage",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "HandleError"
        }
      ]
    },
    "CalculateMonthlyUsage": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:CalculateMonthlyUsage",
      "Parameters": {
        "customerId.$": "$.customerId",
        "currentMonth.$": "$$.State.EnteredTime"
      },
      "ResultPath": "$.monthlyUsage",
      "Next": "CheckUsageLimit",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "Success"
        }
      ]
    },
    "CheckUsageLimit": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:CheckUsageLimit",
      "Parameters": {
        "customerId.$": "$.customerId",
        "currentUsageBytes.$": "$.monthlyUsage.totalUsageBytes",
        "newUsageBytes.$": "$.processingResult.totalSizeBytes"
      },
      "ResultPath": "$.usageLimitResult",
      "Next": "ShouldSendNotification",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "Success"
        }
      ]
    },
    "ShouldSendNotification": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.usageLimitResult.shouldNotify",
          "BooleanEquals": true,
          "Next": "SendNotification"
        }
      ],
      "Default": "Success"
    },
    "SendNotification": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:SendNotification",
      "Parameters": {
        "customerId.$": "$.customerId",
        "notifyEmails.$": "$.usageLimitResult.notifyEmails",
        "exceedingLimits.$": "$.usageLimitResult.exceedingLimits",
        "currentUsageBytes.$": "$.monthlyUsage.totalUsageBytes"
      },
      "ResultPath": "$.notificationResult",
      "Next": "Success",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "Success"
        }
      ]
    },
    "Success": {
      "Type": "Succeed"
    },
    "UnsupportedPolicy": {
      "Type": "Fail",
      "Error": "UnsupportedPolicy",
      "Cause": "The specified policyId is not supported"
    },
    "HandleChildError": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:HandleError",
      "Parameters": {
        "processingHistoryId.$": "$.processingHistoryId",
        "errorType": "ChildStateMachineError",
        "error.$": "$.error",
        "childResult.$": "$.childResult"
      },
      "ResultPath": "$.errorHandlingResult",
      "Next": "Fail"
    },
    "HandleError": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:HandleError",
      "Parameters": {
        "processingHistoryId.$": "$.processingHistoryId",
        "errorType": "ParentStateMachineError",
        "error.$": "$.error",
        "input.$": "$"
      },
      "ResultPath": "$.errorHandlingResult",
      "Next": "Fail"
    },
    "Fail": {
      "Type": "Fail",
      "Error": "ProcessingFailed",
      "Cause": "An error occurred during processing"
    }
  }
}
```

---

## å­Step Functionã®ä¾‹

### å­Step Function 1: ImageProcessingStateMachine

**ASLå®šç¾©**

```json
{
  "Comment": "SiftBeam Image Processing Workflow - ç”»åƒå‡¦ç†å°‚ç”¨",
  "StartAt": "DownloadFromS3",
  "States": {
    "DownloadFromS3": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:DownloadImageFromS3",
      "Parameters": {
        "inputS3Key.$": "$.inputS3Key",
        "inputS3Bucket.$": "$.inputS3Bucket"
      },
      "ResultPath": "$.downloadResult",
      "Next": "ValidateImageFormat",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "ValidateImageFormat": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ValidateImageFormat",
      "Parameters": {
        "imageData.$": "$.downloadResult.imageData",
        "fileName.$": "$.downloadResult.fileName"
      },
      "ResultPath": "$.validationResult",
      "Next": "ParallelImageProcessing",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "ParallelImageProcessing": {
      "Type": "Parallel",
      "Branches": [
        {
          "StartAt": "ResizeThumbnail",
          "States": {
            "ResizeThumbnail": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ResizeImage",
              "Parameters": {
                "imageData.$": "$.downloadResult.imageData",
                "width": 200,
                "height": 200,
                "suffix": "thumbnail"
              },
              "End": true
            }
          }
        },
        {
          "StartAt": "ResizeMedium",
          "States": {
            "ResizeMedium": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ResizeImage",
              "Parameters": {
                "imageData.$": "$.downloadResult.imageData",
                "width": 800,
                "height": 600,
                "suffix": "medium"
              },
              "End": true
            }
          }
        },
        {
          "StartAt": "ResizeLarge",
          "States": {
            "ResizeLarge": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ResizeImage",
              "Parameters": {
                "imageData.$": "$.downloadResult.imageData",
                "width": 1920,
                "height": 1080,
                "suffix": "large"
              },
              "End": true
            }
          }
        }
      ],
      "ResultPath": "$.resizedImages",
      "Next": "OptimizeImages",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "OptimizeImages": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:OptimizeImages",
      "Parameters": {
        "images.$": "$.resizedImages"
      },
      "ResultPath": "$.optimizedImages",
      "Next": "ShouldAddWatermark",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "ShouldAddWatermark": {
      "Type": "Choice",
      "Choices": [
        {
          "Variable": "$.aiTrainingUsage",
          "StringEquals": "deny",
          "Next": "AddWatermark"
        }
      ],
      "Default": "ConvertFormat"
    },
    "AddWatermark": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:AddWatermark",
      "Parameters": {
        "images.$": "$.optimizedImages",
        "watermarkText": "Internal Use Only"
      },
      "ResultPath": "$.watermarkedImages",
      "Next": "ConvertFormat",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "ConvertFormat": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ConvertImageFormat",
      "Parameters": {
        "images.$": "$.watermarkedImages",
        "targetFormat": "webp"
      },
      "ResultPath": "$.convertedImages",
      "Next": "UploadToS3",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "UploadToS3": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:UploadImagesToS3",
      "Parameters": {
        "images.$": "$.convertedImages",
        "customerId.$": "$.customerId",
        "processingHistoryId.$": "$.processingHistoryId"
      },
      "ResultPath": "$.uploadResult",
      "Next": "ReturnResult",
      "Catch": [
        {
          "ErrorEquals": ["States.ALL"],
          "ResultPath": "$.error",
          "Next": "ChildFail"
        }
      ]
    },
    "ReturnResult": {
      "Type": "Pass",
      "Parameters": {
        "outputS3Keys.$": "$.uploadResult.s3Keys",
        "totalSizeBytes.$": "$.uploadResult.totalSizeBytes",
        "processedCount.$": "$.uploadResult.count"
      },
      "End": true
    },
    "ChildFail": {
      "Type": "Fail",
      "Error": "ImageProcessingFailed",
      "Cause": "An error occurred during image processing"
    }
  }
}
```

### å­Step Function 2: SpreadsheetProcessingStateMachine

**ASLå®šç¾©ï¼ˆç°¡ç•¥ç‰ˆï¼‰**

```json
{
  "Comment": "SiftBeam Spreadsheet Processing Workflow - è¡¨è¨ˆç®—å‡¦ç†å°‚ç”¨",
  "StartAt": "DownloadSpreadsheet",
  "States": {
    "DownloadSpreadsheet": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:DownloadSpreadsheetFromS3",
      "Next": "ParseSpreadsheet"
    },
    "ParseSpreadsheet": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ParseSpreadsheet",
      "Next": "DataCleansing"
    },
    "DataCleansing": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:DataCleansing",
      "Next": "PerformCalculations"
    },
    "PerformCalculations": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:PerformCalculations",
      "Next": "GenerateCharts"
    },
    "GenerateCharts": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:GenerateCharts",
      "Next": "ExportToMultipleFormats"
    },
    "ExportToMultipleFormats": {
      "Type": "Parallel",
      "Branches": [
        {
          "StartAt": "ExportToExcel",
          "States": {
            "ExportToExcel": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ExportToExcel",
              "End": true
            }
          }
        },
        {
          "StartAt": "ExportToCSV",
          "States": {
            "ExportToCSV": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ExportToCSV",
              "End": true
            }
          }
        },
        {
          "StartAt": "ExportToPDF",
          "States": {
            "ExportToPDF": {
              "Type": "Task",
              "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:ExportToPDF",
              "End": true
            }
          }
        }
      ],
      "Next": "UploadResultsToS3"
    },
    "UploadResultsToS3": {
      "Type": "Task",
      "Resource": "arn:aws:lambda:REGION:ACCOUNT_ID:function:UploadSpreadsheetResultsToS3",
      "Next": "ReturnResult"
    },
    "ReturnResult": {
      "Type": "Pass",
      "End": true
    }
  }
}
```

---

## ãƒãƒªã‚·ãƒ¼ã”ã¨ã®å­Step Functionä¸€è¦§

| ãƒãƒªã‚·ãƒ¼ID | å­Step Functionå | ä¸»ãªå‡¦ç†å†…å®¹ |
|-----------|------------------|-------------|
| `policy-image-processing` | ImageProcessingSM | ãƒªã‚µã‚¤ã‚ºã€æœ€é©åŒ–ã€é€ã‹ã—ã€å½¢å¼å¤‰æ› |
| `policy-spreadsheet-processing` | SpreadsheetProcessingSM | ãƒ‡ãƒ¼ã‚¿ã‚¯ãƒ¬ãƒ³ã‚¸ãƒ³ã‚°ã€è¨ˆç®—ã€ã‚°ãƒ©ãƒ•ç”Ÿæˆã€ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |
| `policy-video-processing` | VideoProcessingSM | ãƒˆãƒ©ãƒ³ã‚¹ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°ã€ã‚µãƒ ãƒã‚¤ãƒ«ç”Ÿæˆã€å­—å¹•è¿½åŠ  |
| `policy-audio-processing` | AudioProcessingSM | æ–‡å­—èµ·ã“ã—ã€ãƒã‚¤ã‚ºé™¤å»ã€å½¢å¼å¤‰æ› |
| `policy-text-processing` | TextProcessingSM | NLPã€ç¿»è¨³ã€è¦ç´„ã€æ„Ÿæƒ…åˆ†æ |
| `policy-pdf-processing` | PDFProcessingSM | ãƒ†ã‚­ã‚¹ãƒˆæŠ½å‡ºã€ç”»åƒæŠ½å‡ºã€çµåˆã€åˆ†å‰² |

---

## Lambdaé–¢æ•°ä¸€è¦§

### è¦ªStep Functionç”¨Lambdaé–¢æ•°

| é–¢æ•°å | å½¹å‰² |
|--------|------|
| `TriggerParentStepFunction` | S3ã‚¤ãƒ™ãƒ³ãƒˆã‹ã‚‰è¦ªStep Functionã‚’èµ·å‹• |
| `ValidateInput` | å…¥åŠ›æ¤œè¨¼ã€ä½¿ç”¨é‡äº‹å‰ãƒã‚§ãƒƒã‚¯ |
| `UpdateProcessingHistory` | processing-historyæ›´æ–° |
| `CalculateMonthlyUsage` | æœˆé–“ä½¿ç”¨é‡è¨ˆç®— |
| `CheckUsageLimit` | ä½¿ç”¨é‡åˆ¶é™ãƒã‚§ãƒƒã‚¯ |
| `SendNotification` | SESã§é€šçŸ¥ãƒ¡ãƒ¼ãƒ«é€ä¿¡ |
| `HandleError` | ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚° |

### å­Step Functionç”¨Lambdaé–¢æ•°ï¼ˆç”»åƒå‡¦ç†ã®ä¾‹ï¼‰

| é–¢æ•°å | å½¹å‰² |
|--------|------|
| `DownloadImageFromS3` | S3ã‹ã‚‰ç”»åƒãƒ€ã‚¦ãƒ³ãƒ­ãƒ¼ãƒ‰ |
| `ValidateImageFormat` | ç”»åƒå½¢å¼æ¤œè¨¼ |
| `ResizeImage` | ç”»åƒãƒªã‚µã‚¤ã‚º |
| `OptimizeImages` | ç”»åƒæœ€é©åŒ–ï¼ˆåœ§ç¸®ï¼‰ |
| `AddWatermark` | é€ã‹ã—è¿½åŠ  |
| `ConvertImageFormat` | ç”»åƒå½¢å¼å¤‰æ› |
| `UploadImagesToS3` | å‡¦ç†æ¸ˆã¿ç”»åƒã‚’S3ã«ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰ |

---

## S3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥è¨­å®š

### S3ãƒã‚±ãƒƒãƒˆè¨­å®š

```json
{
  "LambdaFunctionConfigurations": [
    {
      "Id": "TriggerServiceProcessing",
      "LambdaFunctionArn": "arn:aws:lambda:REGION:ACCOUNT_ID:function:TriggerParentStepFunction",
      "Events": ["s3:ObjectCreated:*"],
      "Filter": {
        "Key": {
          "FilterRules": [
            {
              "Name": "prefix",
              "Value": "service/input/"
            }
          ]
        }
      }
    }
  ]
}
```

---

## å­Step Functionã®ç™»éŒ²ãƒ»ç®¡ç†

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³1: ç’°å¢ƒå¤‰æ•°ã§ç®¡ç†ï¼ˆæ¨å¥¨ï¼‰

**è¦ªStep Functionã®Lambdaé–¢æ•°ï¼ˆDetermineChildStateMachineç›¸å½“ï¼‰**

```python
import os

CHILD_STATE_MACHINES = {
    'policy-image-processing': os.environ.get('IMAGE_PROCESSING_SM_ARN'),
    'policy-spreadsheet-processing': os.environ.get('SPREADSHEET_PROCESSING_SM_ARN'),
    'policy-video-processing': os.environ.get('VIDEO_PROCESSING_SM_ARN'),
    'policy-audio-processing': os.environ.get('AUDIO_PROCESSING_SM_ARN'),
    'policy-text-processing': os.environ.get('TEXT_PROCESSING_SM_ARN'),
    'policy-pdf-processing': os.environ.get('PDF_PROCESSING_SM_ARN'),
}

def lambda_handler(event, context):
    policy_id = event['policyId']
    
    if policy_id not in CHILD_STATE_MACHINES:
        raise ValueError(f"Unsupported policyId: {policy_id}")
    
    child_sm_arn = CHILD_STATE_MACHINES[policy_id]
    
    if not child_sm_arn:
        raise ValueError(f"No State Machine ARN configured for policyId: {policy_id}")
    
    return {
        'childStateMachineArn': child_sm_arn,
        'policyType': policy_id.replace('policy-', '').replace('-processing', '')
    }
```

### ã‚ªãƒ—ã‚·ãƒ§ãƒ³2: DynamoDBã§ç®¡ç†ï¼ˆå‹•çš„ï¼‰

**DynamoDBãƒ†ãƒ¼ãƒ–ãƒ«: `policy-configurations`**

| policyId | stateMachineArn | description |
|----------|----------------|-------------|
| policy-image-processing | arn:aws:states:... | ç”»åƒå‡¦ç†ç”¨Step Function |
| policy-spreadsheet-processing | arn:aws:states:... | è¡¨è¨ˆç®—å‡¦ç†ç”¨Step Function |

**Lambdaé–¢æ•°**

```python
import boto3

dynamodb = boto3.resource('dynamodb')
table = dynamodb.Table('policy-configurations')

def lambda_handler(event, context):
    policy_id = event['policyId']
    
    response = table.get_item(Key={'policyId': policy_id})
    
    if 'Item' not in response:
        raise ValueError(f"Unsupported policyId: {policy_id}")
    
    policy_config = response['Item']
    
    return {
        'childStateMachineArn': policy_config['stateMachineArn'],
        'policyType': policy_config.get('policyType', 'generic')
    }
```

**æ¨å¥¨**: ã‚ªãƒ—ã‚·ãƒ§ãƒ³1ï¼ˆç’°å¢ƒå¤‰æ•°ï¼‰ã®æ–¹ãŒã‚·ãƒ³ãƒ—ãƒ«ã§ä½ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ãƒ¼

---

## æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã®è¿½åŠ æ‰‹é †

### ã‚¹ãƒ†ãƒƒãƒ—1: å­Step Functionã‚’ä½œæˆ

1. æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ç”¨ã®Lambdaé–¢æ•°ã‚’å®Ÿè£…
2. å­Step unctionã®ASLå®šç¾©ã‚’ä½œæˆ
3. Step Functionsã‚’ãƒ‡ãƒ—ãƒ­ã‚¤

### ã‚¹ãƒ†ãƒƒãƒ—2: è¦ªStep Functionã«ç™»éŒ²

#### æ–¹æ³•A: ASLå®šç¾©ã‚’æ›´æ–°ï¼ˆChoice Stateã«è¿½åŠ ï¼‰

```json
{
  "DetermineChildStateMachine": {
    "Type": "Choice",
    "Choices": [
      // æ—¢å­˜ã®ãƒãƒªã‚·ãƒ¼...
      {
        "Variable": "$.policyId",
        "StringEquals": "policy-new-processing",
        "Next": "SetNewProcessingSM"
      }
    ]
  },
  "SetNewProcessingSM": {
    "Type": "Pass",
    "Parameters": {
      "childStateMachineArn": "arn:aws:states:REGION:ACCOUNT_ID:stateMachine:NewProcessingSM",
      "policyType": "new"
    },
    "ResultPath": "$.childSMInfo",
    "Next": "InvokeChildStateMachine"
  }
}
```

#### æ–¹æ³•B: ç’°å¢ƒå¤‰æ•°ã‚’è¿½åŠ 

```bash
aws lambda update-function-configuration \
  --function-name DetermineChildStateMachine \
  --environment Variables={NEW_PROCESSING_SM_ARN=arn:aws:states:...}
```

### ã‚¹ãƒ†ãƒƒãƒ—3: ãƒ†ã‚¹ãƒˆ

1. ãƒãƒªã‚·ãƒ¼ã‚’DynamoDBã«ç™»éŒ²
2. ãƒ†ã‚¹ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã‚’ã‚¢ãƒƒãƒ—ãƒ­ãƒ¼ãƒ‰
3. å‡¦ç†ãŒæ­£å¸¸ã«å®Œäº†ã™ã‚‹ã“ã¨ã‚’ç¢ºèª

---

## è¦ªå­Step Functionã®é€šä¿¡

### è¦ªã‹ã‚‰å­ã¸ã®å…¥åŠ›

```json
{
  "processingHistoryId": "uuid-xxx",
  "customerId": "customer-123",
  "userId": "user-456",
  "userName": "å±±ç”°å¤ªéƒ",
  "policyId": "policy-image-processing",
  "policyName": "ç”»åƒå‡¦ç†ã‚µãƒ¼ãƒ“ã‚¹",
  "inputS3Key": "service/input/customer-123/uuid-xxx/file.jpg",
  "inputS3Bucket": "siftbeam",
  "uploadedFileKeys": ["service/input/..."],
  "aiTrainingUsage": "allow",
  "createdAt": "2025-10-15T12:00:00.000Z"
}
```

### å­ã‹ã‚‰è¦ªã¸ã®å‡ºåŠ›

```json
{
  "outputS3Keys": [
    "service/output/customer-123/uuid-xxx/file_thumbnail.webp",
    "service/output/customer-123/uuid-xxx/file_medium.webp",
    "service/output/customer-123/uuid-xxx/file_large.webp"
  ],
  "totalSizeBytes": 1234567,
  "processedCount": 3
}
```

---

## ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°æˆ¦ç•¥

### å­Step Functionã§ã®ã‚¨ãƒ©ãƒ¼

1. **å­Step Functionå†…ã§Catch**
   - ã‚¨ãƒ©ãƒ¼ã‚’ãƒ­ã‚°ã«è¨˜éŒ²
   - ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’å«ã‚€ãƒ¬ã‚¹ãƒãƒ³ã‚¹ã‚’è¿”ã™
   - è¦ªã«ä¼æ’­

2. **è¦ªStep Functionã§Catch**
   - `HandleChildError`ã‚¹ãƒ†ãƒ¼ãƒˆã§å‡¦ç†
   - processing-historyã‚’æ›´æ–°ï¼ˆstatus: failedï¼‰
   - ã‚¨ãƒ©ãƒ¼è©³ç´°ã‚’è¨˜éŒ²

### è¦ªStep Functionã§ã®ã‚¨ãƒ©ãƒ¼

1. **å„ã‚¹ãƒ†ãƒ¼ãƒˆã§Catch**
   - `HandleError`ã‚¹ãƒ†ãƒ¼ãƒˆã§å‡¦ç†
   - processing-historyã‚’æ›´æ–°
   - å¤±æ•—ã¨ã—ã¦è¨˜éŒ²

---

## ã¾ã¨ã‚

### è¨­è¨ˆã®ãƒã‚¤ãƒ³ãƒˆ

1. **è¦ªå­æ§‹é€ ã®æ˜ç¢ºãªå½¹å‰²åˆ†æ‹…**
   - è¦ª: æ±ç”¨å‡¦ç†ï¼ˆæ¤œè¨¼ã€èª²é‡‘ã€é€šçŸ¥ï¼‰
   - å­: ãƒãƒªã‚·ãƒ¼å›ºæœ‰ã®è¤‡é›‘ãªå‡¦ç†

2. **å­Step Functionã®æŸ”è»Ÿãªè¿½åŠ **
   - æ–°ã—ã„ãƒãƒªã‚·ãƒ¼ã¯æ–°ã—ã„å­Step Functionã‚’ä½œæˆ
   - è¦ªStep Functionã®Choice Stateã«è¿½åŠ ã™ã‚‹ã ã‘

3. **S3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®æ´»ç”¨**
   - EventBridgeã§ã¯ãªãã€ã‚·ãƒ³ãƒ—ãƒ«ã§ä½ã‚³ã‚¹ãƒˆãªS3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥

4. **åŒæœŸå®Ÿè¡Œã®æ´»ç”¨**
   - `.sync:2`ã‚’ä½¿ã£ã¦å­ã®å®Œäº†ã‚’å¾…æ©Ÿ
   - è¦ªãŒå­ã®çµæœã‚’å—ã‘å–ã£ã¦å¾Œç¶šå‡¦ç†

5. **ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã®éšå±¤åŒ–**
   - å­: å‡¦ç†å›ºæœ‰ã®ã‚¨ãƒ©ãƒ¼
   - è¦ª: å…¨ä½“çš„ãªã‚¨ãƒ©ãƒ¼ã¨çŠ¶æ…‹ç®¡ç†

### æ¬¡ã®ã‚¹ãƒ†ãƒƒãƒ—

1. âœ… S3ãƒ‘ã‚¹è¨­è¨ˆã®ç¢ºèª â†’ å®Œäº†
2. âœ… ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£è¨­è¨ˆ â†’ å®Œäº†
3. â¬œ Lambdaé–¢æ•°ã®å®Ÿè£…
   - è¦ªStep Functionç”¨Lambdaé–¢æ•°
   - å­Step Functionç”¨Lambdaé–¢æ•°ï¼ˆãƒãƒªã‚·ãƒ¼ã”ã¨ï¼‰
4. â¬œ Step Functionså®šç¾©ã®å®Ÿè£…
   - è¦ªStep Function ASL
   - å­Step Function ASLï¼ˆãƒãƒªã‚·ãƒ¼ã”ã¨ï¼‰
5. â¬œ S3ã‚¤ãƒ™ãƒ³ãƒˆé€šçŸ¥ã®è¨­å®š
6. â¬œ IAMæ¨©é™ã®è¨­å®š
7. â¬œ ãƒ†ã‚¹ãƒˆãƒ»ãƒ‡ãƒãƒƒã‚°

ã©ã®ãƒãƒªã‚·ãƒ¼ã‹ã‚‰å®Ÿè£…ã‚’å§‹ã‚ã¾ã™ã‹ï¼Ÿã¾ãšã¯ç”»åƒå‡¦ç†ã‹ã‚‰å§‹ã‚ã‚‹ã®ãŒãŠã™ã™ã‚ã§ã™ã€‚ğŸš€

